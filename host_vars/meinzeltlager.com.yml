---
roles:
  - defaults
  - sshd
  - caddy
  - postgresql
  - mail
  - php
  - mysql
  - phpmyadmin
  - mediawiki
  - zeltlager_website

caddy_user: http
caddy_conf_file: caddy.conf
caddy_sites:
  mail.meinzeltlager.com: |
    mail.meinzeltlager.com {
      redir https://meinzeltlager.com
    }

  meinzeltlager.com: |
    meinzeltlager.com {
      import ../defaults
      import ../ssl_defaults
      header / Content-Security-Policy "default-src 'self' 'unsafe-inline' data:; form-action 'self'; frame-ancestors 'self'"

      proxy / localhost:{{ zeltlager_website_port }} {
        transparent
      }
    }

    meinzeltlager.com/google9cea32bbccdb1ab4.html {
      import ../defaults
      import ../ssl_defaults
      rewrite {
        to /google9cea32bbccdb1ab4.html
      }
      root /srv/http/html
    }

    www.meinzeltlager.com {
      redir 301 {
        / https://meinzeltlager.com{uri}
        }
    }

  wiki.meinzeltlager.com: |
    wiki.meinzeltlager.com {
      import ../defaults
      import ../ssl_defaults
      header / Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval' data:; form-action 'self'; frame-ancestors 'self'"

      root /usr/share/webapps/mediawiki
      fastcgi / /run/php-fpm/php-fpm.sock php {
        except /images
      }
      status 404 /images/deleted
      rewrite /wiki {
        r /(.*)
        to /index.php?title={1}
      }
    }

  webapps: |
    *:8080 {
      import ../defaults
      header / Content-Security-Policy "default-src 'self' 'unsafe-inline' data: ws:"
      bind 127.0.0.1

      root /usr/share/webapps
      fastcgi / /run/php-fpm/php-fpm.sock php
    }

sshd_host_settings:
  - regexp: "^#?AllowUsers "
    line: AllowUsers ansible zeltlager alina

acme_path: /var/lib/caddy/acme/acme-v02.api.letsencrypt.org
dovecot_settings:
  - listen = [::]

php_extensions:
  - mysqli
  - pgsql
  - pdo_mysql
  - pdo_pgsql
  - gd
  - intl
  - iconv

postgresql_locale: en_US.UTF-8
postgres_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  62303132373663626233643531353565336166653032333364653038396534373336383535633336
  3036386566346466663064663363666336616531656664640a313663356434653638383433313365
  34623439616436643338303165323564646430356661356561306636386131646165393730363464
  3931613036643232630a393361353833643661356661626463303136336161313463613136663136
  65633035393732656434306438626138306330343737666265653166623035393562

mysql_root_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  37373839653963633961643937333336663530316662326665303230616237323837343538656264
  3066343839616161616234383531323434333565346433630a303335383362376261653535613830
  61313833333435326162336161366136663363386662363364353439303335383366376466353663
  3037333863616331660a396334643863393638643733383533626663666661613065393631643633
  64386136336331303962373632393736313936663365363561633461346266616534

postfix_db_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  30623766646536663165626634366234366133643363326437393734393536663431313335653233
  3537613465623433343838666131643039653833306265370a353236346534643838333130376163
  32353864626139343732396535313431333162623262393537356337323164306537356663613166
  3331333632383738380a643131313531343332396139386431353434373230363566396363363161
  33386537656666346338663166623933353733653632373631663362393563333138

zeltlager_db_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  66323265313036366262663662356438366137646639376339653461303235633131363737343862
  6163653762393963383333626331653163643961346438330a396437366265376231316366336537
  30623333313330626561373563373637306232613233626161346435303833386431663563623631
  3864666462363065300a653266373662313336663461343637373861373461663237666563336630
  64386136303466623838356164393231346134303232353965663361383031376137
zeltlager_website_mail_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  61663162303866386531383031633465396661613039346136366235633164653537316264623563
  3462613563653639366639663162373566326536356333650a613538636466396136386464373635
  36613561323731343664633365653533386130636564336531396632383031333939356634633535
  3632353633643761320a366236383039666363343738666437353463373061373739643862376131
  36663362326534663936633235643531306161336430366262366533393638393536

mediawiki_db_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  66663335383166663633303331303233623866356436383432656162326361353236653731623330
  3533363935343065663332363431623161633766633835610a666230363830353733623965316639
  33373831633539633566363563343630343464353361396465373638383663626664666338633465
  3033363637316235630a663637346364333462353634663266323534376162356363363461376466
  65323531353130333436623637653461386230366161343034373937386230313264
mediawiki_secret_key: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  64623538383063623138313933666561323663643838613834643863666161393739396138623738
  6433623937333030336633336633336332303732306130320a663539666330373237396238386264
  30383763323836316238613661316137653866343338666638386130656134313633373161393330
  3234366533366630370a653630343636326331376364343339383433613131653836363964336136
  37376538396134373134613863366664666135313931616533386130633333663438386332383838
  38303938346136396364623065386566613365656532666666376431343833626537623264643332
  32356265636331343833393437643934376138633836643462303836316665323661333535303764
  62643762656238633239
mediawiki_upgrade_key: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  64336638386636666664623636616638336461663261613962333165333333653033373334353531
  6437333333363663303638383561383162656431653530320a323063396561636364336237613334
  30623766336634303962633833376664613436313766643535636461373166663937376533623439
  3633373733633532610a333431363534326664306633373565643531326662313832646266636535
  66336137666262303539633366393731366264616536616638383766643839373263
mediawiki_mail_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  31333638386134636562306235326637653566393337613738376633333732303963333463373761
  3863316136333961666362336665303864646263663536620a343839643264643037646630363337
  32306565613036646539356565306138653762343766346336613432646539313739633136393032
  3533383035333862310a316637396530323932613061383830383835303364666434383461323036
  34313031646535666264663762383639343166353562393839633831616462326532
